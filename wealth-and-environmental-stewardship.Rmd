---
title: "Wealth and Environmental Stewardship"
author: "Felipe Valencia"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:  
    keep_md: true
    toc: true
    toc_float: true
    code_folding: hide
    fig_height: 6
    fig_width: 12
    fig_align: 'center'
---

```{r, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r load_libraries, include=FALSE}
# Load Libraries
library(tidyverse)
library(downloader)
library(readxl)
library(foreign)
library(stringr)
library(psych)
library(vtable)
library(ggrepel)
```

```{r load_data}
# Import data

############# Survey of owners of BEVs in California #############
# Read xlsx
# Temporary file
temp_excel <- tempfile()
# Download using downloader package
download("https://datadryad.org/stash/downloads/file_stream/153034",
         dest = temp_excel, # Save temp file
         mode = "wb")
# Read xlxs from temp file
BEV_FCV <- read_excel(temp_excel)

############# GDP per capita (current US$) #############
# Download zip using downloader package
# Temporary file
temp_zip <- tempfile()
# Temporary directory
temp_dir <- tempdir()
# Download using downloader library
download("https://api.worldbank.org/v2/en/indicator/NY.GDP.PCAP.CD?downloadformat=csv",
         destfile = temp_zip, # Save temp file
         mode = "wb")
# Unzip temporary file in temporary directory
unzip(temp_zip, exdir = temp_dir)

# Read csv file using foreign package
GDP <- read_csv(paste(temp_dir, "API_NY.GDP.PCAP.CD_DS2_en_csv_v2_5358417.csv", sep = "/"), skip = 3)

############# CO2 emissions (metric tons per capita) #############
# Download zip using downloader package
# Temporary file
temp_zip <- tempfile()
# Temporary directory
temp_dir <- tempdir()
# Download using downloader library
download("https://api.worldbank.org/v2/en/indicator/EN.ATM.CO2E.PC?downloadformat=csv",
         destfile = temp_zip, # Save temp file
         mode = "wb")
# Unzip temporary file in temporary directory
unzip(temp_zip, exdir = temp_dir)

# Read csv file using foreign package
CO2_emissions <- read_csv(paste(temp_dir, "API_EN.ATM.CO2E.PC_DS2_en_csv_v2_5358914.csv", sep = "/"), skip = 3)

# Read csv of the ISO 3166 Countries with Regional Codes (taken from Luke Duncalfe's GitHub reop)
countries_ISO3166 <- read.csv("https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv?raw=true")

```

## Background

__My question:__ Is it true that _as people get wealthier, they care and do more for the environment?_.

Here are the data sets I have found that I think will help me answer my question for this project:

+ [GDP per capita - current US dollars](https://data.worldbank.org/indicator/NY.GDP.PCAP.CD) from The World Bank.
    + This data set contains the GDP per capita in current US dollars for almost all countries with data from 1960 to 2021. According to Investopedia GDP per capita _"measures the economic output of a nation per person. It seeks to determine the prosperity of a nation by economic growth per person in that nation. Per capita income measures the amount of money earned per person in a nation."_
    + GDP per capita will be the socioeconomic metric.
+ [CO2 emissions (metric tons per capita)](https://data.worldbank.org/indicator/EN.ATM.CO2E.PC) from The World Bank.
    + This data set contains the CO2 emissions (metric tons per capita) for almost all countries with data from 1990 to 2019. The World Bank says: _"Carbon dioxide emissions are those stemming from the burning of fossil fuels and the manufacture of cement. They include carbon dioxide produced during consumption of solid, liquid, and gas fuels and gas flaring."_
    + CO2 emissions (metric tons per capita) will be our environmental metric.
+ [Encuestas de movilidad 2019](https://www.simur.gov.co/encuestas-de-movilidad) from Secretaría Distrital de Movilidad (SDM) of Bogota City Hall. (Bogota is the capital of Colombia)
    + This data set has information about travels, people, households, vehicles, etc. It's from a survey conducted by request of the Bogota City Hall to _"characterizes the mobility of the population equal to or greater than 5 years of age residing in the urban area of Bogotá and 18 neighboring municipalities in its area of influence: Bojacá, Cajicá, Chía, Cota, El Rosal, Facatativá, Funza, Gachancipá, La Calera, Madrid, Mosquera, Sibaté, Soacha, Sopó, Tabio, Tenjo, Tocancipá and Zipaquirá."_
    + This data set has the socioeconomic strata (to know the affluence) and types of vehicle (to see if there are EVs).
+ [Sociodemographic data for battery electric vehicle owning households in California (From NCST Project "Understanding the Early Adopters of Fuel Cell Vehicles")](https://datadryad.org/stash/dataset/doi:10.25338/B8P313) from Scott Hardman of the University of California and published in DRYAD.
    + This data set contains _"Sociodemographic data for fuel cell and battery electric vehicle owning households in California."_
    + This data set is from owners of BEVs and FCVs in California, it has their estimated income and a score measuring their perception of the importance of reducing greenhouse gas emissions.
+ [Number of passenger cars per adult in households, by household income. 2018-2019](https://www.ssb.no/en/transport-og-reiseliv/artikler-og-publikasjoner/the-wealthiest-bought-4-out-of-10-evs?tabell=417112) from the article by Statistics Norway called _"The wealthiest bought 4 out of 10 EVs"_.
    + This data set contains data from 2018 and 2019 about the number of passenger cars per adult in households by household income, it has data on fossil cars and electric cars.
    + This data set is already aggregated, therefore, there's not much to explore but it seems it can help solidify my answer.

## Owners of BEVs in California

This data set contains [Sociodemographic data for battery electric vehicle owning households in California (From NCST Project "Understanding the Early Adopters of Fuel Cell Vehicles")](https://doi.org/10.25338/B8P313). We are only going to focus on the: Information on vehicle owned, Household Income, Highest Level of Education, Age, Gender, Number of vehicles in the household, and a scale of the importance of reducing Greenhouse Gas Emissions (GGE). It contains around 906  Fuel-Cell Vehicles (FCV) respondents, but we are going to ignore them and focus on the results from Battery Electric Vehicle (BEV) respondents. We assume that those that own a BEV are _"environmentally friendly"_, and we are going to see if their wealth affects that perspective.

### Data Wrangling

Here's the data set we have cleaned and prepared for our analysis:

```{r tidy_data}
# Clean & wrangle data

BEV <- BEV_FCV %>%
  filter(!is.na(`submitdate. Date submitted`)) %>%
  rename(Household_Income = `Household Income`,
         ID = `id. Response ID`,
         importance_reduce_GGE = `Importance of reducing greenhouse gas emissions (-3 not important, 3 important)`,
         edu_level = `Highest Level of Education`,
         number_vehicles_H = `Number of vehicles in the household`,
         gender = `Gender (Male 1)`) %>%
  mutate(Household_Income_Thousands = Household_Income / 1000,
         edu_level = str_replace_all(as.character(edu_level), c("1" = "Some High School", "2" = "High School Graduate", "3" = "College Graduate", "4" = "Masters, Doctorate, \nor Professional Degree")),
         gender = str_replace_all(as.character(gender), c("1" = "Male", "0" = "Female"))) %>%
  select(ID, Carmain, Household_Income_Thousands, importance_reduce_GGE, edu_level, number_vehicles_H, gender, Age) %>%
  filter(grepl('PHASE', ID))

# Turn Household income in thousands, gender and edu_level to factors
BEV$Household_Income_Thousands <- as.factor(BEV$Household_Income_Thousands)
BEV$gender <- as.factor(BEV$gender)
BEV$edu_level <- as.factor(BEV$edu_level)
# Custom order for the edu_level factor
BEV$edu_level <- factor(BEV$edu_level, levels = c("Some High School", "High School Graduate", "College Graduate", "Masters, Doctorate, \nor Professional Degree"))
BEV

```
### Summary Statistics

```{r stats1}
# Get Summary Statistics
BEV %>% st()

```

### Data Visualization and Discussion

```{r plot_data1}
# Plot & visualize data
BEV %>% ggplot(aes(x = importance_reduce_GGE)) +
  geom_histogram(binwidth = 0.3, color = "green4", fill = "gray80") +
  theme_classic() +
  scale_x_continuous(breaks = c(-3, -2, -1, 0, 1, 2, 3),
                     expand = expansion(mult = c(0, 0))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0))) +
  theme(panel.grid.major.y = element_line(color = "gray", linetype = 1),
        plot.title.position = "plot",
        plot.title = element_text(size = 25, family = "serif", color = "black"),
        plot.subtitle = element_text(size = 18, family = "serif", color = "gray30"),
        plot.caption = element_text(hjust = 1, family = "serif", color = "gray30", size = 12),
        axis.title = element_text(color = "gray30", size = 16, family = "serif"),
        axis.text.x = element_text(color = "gray30", size = 14, family = "serif"),
        axis.text.y = element_text(color = "gray30", size = 14, family = "serif")) +
  labs(title = "Distribution of attitudes toward sustainability", subtitle = "Owners of BEVs in California were asked about how important is reducing greenhouse gas emissions. \nMeasured with a continuous scale from -3= “Not important” to 3= “Important”", y = "Count", x = "Scale", caption = "Source: National Center for Sustainable Transportation\nhttps://doi.org/10.25338/B8P313")

```
Going back to the summary statistics table, the mean of this scale is around `1.7`, which tells us there's an attitude of care for the sustainability of the environment from owners of BEVs in California. With the histogram, we can see the majority of the respondents consider _"Important"_ to a certain extent reducing greenhouse gas emissions.

Now, let's focus on the wealth of the owners of BEVs in California. According to the summary statistics, we have the majority of the respondents with an income between _$75k_ and _$225k_, but we have enough data for incomes greater than _$225k_ to see if on average people with higher income care more about the environment than those with lower incomes among those that we consider _"environmentally friendly"_ due to owning a BEV.

```{r plot_data2}
# Plot & visualize data

# Turn Household income in thousands factor to a numeric data type
BEV$Household_Income_Thousands <- as.numeric(as.character(BEV$Household_Income_Thousands))

BEV %>%
  filter(!is.na(Household_Income_Thousands)) %>%
  filter(!is.na(edu_level)) %>%
  ggplot(aes(y = importance_reduce_GGE, x = Household_Income_Thousands)) +
  geom_smooth(color = "green4") +
  theme_classic() +
  #coord_cartesian(ylim = c(-3, 3), xlim = c(50, 500))
  scale_x_continuous(breaks = c(50, 75, 125, 175, 225, 275, 325, 375, 425, 475, 500),
                     expand = expansion(mult = c(0, 0))) +
  theme(panel.grid.major.y = element_line(color = "gray", linetype = 1),
        plot.title.position = "plot",
        plot.title = element_text(size = 25, family = "serif", color = "black"),
        plot.subtitle = element_text(size = 18, family = "serif", color = "gray30"),
        plot.caption = element_text(hjust = 1, family = "serif", color = "gray30", size = 12),
        axis.title = element_text(color = "gray30", size = 16, family = "serif"),
        axis.text.x = element_text(color = "gray30", size = 14, family = "serif", hjust = c(0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 1)),
        axis.text.y = element_text(color = "gray30", size = 14, family = "serif")) +
  labs(title = "Correlation between household income and attitude toward environmental sustainability", subtitle = "Owners of BEVs in California were asked about how important is reducing greenhouse gas emissions. \nMeasured with a continuous scale from -3= “Not important” to 3= “Important”", y = "Mean importance of reducing GGE", x = "Income in thousands of dollars", caption = "Source: National Center for Sustainable Transportation\nhttps://doi.org/10.25338/B8P313")
```
Although the mean is between `1.5` and `1.8`, which leans towards the _“Important”_ attitude, we see that, on average, more affluent owners of BEVs in California consider it less important than those with lower incomes.

```{r plot_data3}
# Plot & visualize data
BEV %>%
  filter(!is.na(Household_Income_Thousands)) %>%
  filter(!is.na(edu_level)) %>%
  # Remove "Some High School" observations because they were too small N=43 to be significant
  filter(edu_level != "Some High School") %>%
  ggplot(aes(y = importance_reduce_GGE, x = Household_Income_Thousands)) +
  geom_smooth(color = "green4") +
  facet_wrap(~edu_level, nrow = 1) +
  theme_classic() +
  scale_x_continuous(breaks = c(50, 75, 125, 175, 225, 275, 325, 375, 425, 475, 500)) +
  theme(panel.grid.major.y = element_line(color = "gray", linetype = 1),
        plot.title.position = "plot",
        plot.title = element_text(size = 25, family = "serif", color = "black"),
        plot.subtitle = element_text(size = 18, family = "serif", color = "gray30"),
        plot.caption = element_text(hjust = 1, family = "serif", color = "gray30", size = 12),
        axis.title = element_text(color = "gray30", size = 16, family = "serif"),
        axis.text.x = element_text(color = "gray30", size = 14, family = "serif", angle = 90, hjust = 1, vjust = 0.5),
        axis.text.y = element_text(color = "gray30", size = 14, family = "serif"),
        strip.text.x = element_text(color = "gray10", size = 14, family = "serif"),
        strip.background = element_rect(color = "white", fill = "white")) +
  labs(title = "Correlation between household income and attitude toward environmental sustainability\nby the highest level of education", subtitle = "Owners of BEVs in California were asked about how important is reducing greenhouse gas emissions. \nMeasured with a continuous scale from -3= “Not important” to 3= “Important”", y = "Mean importance of reducing GGE", x = "Income in thousands of dollars", caption = "Source: National Center for Sustainable Transportation\nhttps://doi.org/10.25338/B8P313")
```
First, it's relevant to say that _"Some High School"_ observations were removed because they were too small __N=43__ to be accurate or significant for this analysis.

We can recognize several patterns from the correlation between household income and the attitude towards environmental sustainability segmented by the highest educational level for the owners of BEVs in California. We can see that people with a higher level of education have, on average, a higher "Important" score for the perception of reducing greenhouse gas emissions than those with a lower education level. Also, we discover that more affluent people consider it less important than those with lower incomes when segmented by education level; However, we cannot be sure for the _High School Graduates_ group because the confidence interval is too large at the highest incomes. One of the reasons we might have this wide confidence interval for the perception of reducing GGE of the _High School Graduate_ group with the highest incomes is that we do not have enough observations for this group with these incomes.

An important question to move forward in the analysis is why even the highly educated and wealthier owners of BEVs in California seem to care less about GGE than those at the same educational level but with less affluence, is there something they know that less affluent people in their educational level group don't know about reducing GGE, or is it something that has to do with the psyche of the wealthiest?

Since this wasn't a longitudinal study, we cannot conclude that as people get richer they care more or less about the environment, but we do see that owners of BEVs in California with higher incomes (that are doing something good for the environment by using battery electric vehicles instead of fuel-based ones) on average care about reducing GGE, but they care less than less affluent owners.

It's important to note that a limitation of this data set is that we don't have information about the attitude of owners of non-BEVs, like owners of fuel-based vehicles, to compare if there are differences in their perspectives and their incomes.

### Conclusion

+ Among those in California that are doing something good for the environment by using battery electric vehicles instead of fuel-based ones, on average care about reducing GGE, but the more affluent care less than less affluent owners.
+ When distinguished by the highest level of education, we find the more educated owners of BEVs in California consider more important reducing GGE than less educated owners.
+ When looking at the correlation between the household income in thousands and the mean importance of reducing GGE of BEV owners in California grouped by educational level, the wealthier and more educated care a little bit less than the less affluent.

## GDP per Capita and CO2 Emissions


### Data Wrangling

Here's the data set we have cleaned and prepared for our analysis:

```{r tidy_data2}
# Clean & wrangle data

# GDP per Capita tidy
GDP_long <- GDP %>%
  select(-`Indicator Name`, -`Indicator Code`) %>%
  pivot_longer(!`Country Name`:`Country Code`, names_to = "year", values_to = "GDP_per_cap", values_drop_na = TRUE)

# CO2 Emissions tidy
CO2emissions_long <- CO2_emissions %>%
  select(-`Indicator Name`, -`Indicator Code`) %>%
  pivot_longer(!`Country Name`:`Country Code`, names_to = "year", values_to = "CO2_m_tons_per_cap", values_drop_na = TRUE)

# Join between GDP per Capita and CO2 Emissions tidy
GDP_CO2Emissions <- inner_join(GDP_long, CO2emissions_long, by = c("Country Name", "Country Code", "year")) %>%
  mutate(year = as.double(year))

# Get country regions using ISO3166
code_region <- countries_ISO3166 %>%
  select(alpha.3, region)

# Join GDP per Capita and CO2 Emissions with the country regions
GDP_CO2Emissions_Regions <- right_join(code_region, GDP_CO2Emissions, by = c("alpha.3" = "Country Code"))

# Compute means for each region
Totals_GDP_CO2Emissions_Regions <- GDP_CO2Emissions_Regions %>%
  group_by(region, year) %>%
  summarise(mean_GDP_per_cap = mean(GDP_per_cap),
            mean_CO2_m_tons_per_cap = mean(CO2_m_tons_per_cap))

```
### Summary Statistics

```{r stats2}
# Get Summary Statistics
GDP_CO2Emissions_Regions %>% st()

Totals_GDP_CO2Emissions_Regions %>% st()

```

### Data Visualization and Discussion

```{r plot_data4}
# Plot & visualize data
GDP_CO2Emissions %>%
  filter(`Country Name` == "North America" | `Country Name` == "Latin America & Caribbean" | `Country Name` == "Europe & Central Asia" | `Country Name` == "East Asia & Pacific" | `Country Name` == "South Asia" | `Country Name` == "Middle East & North Africa" | `Country Name` == "Sub-Saharan Africa") %>%
  ggplot(aes(x = year)) +
  geom_line(aes(y = GDP_per_cap), color = "green4") +
  geom_line(aes(y = CO2_m_tons_per_cap * 1500), color = "red4") +
  facet_wrap(~`Country Name`, nrow = 1) +
  scale_y_continuous(name = "GDP per Capita",
                     sec.axis = sec_axis(~.x /1500, name = "CO2 Emissions (Metric tons per Capita")) +
  theme(axis.title.y = element_text(color = "green4"),
        axis.title.y.right = element_text(color = "red4"))
  
```


```{r plot_data5}
# Plot & visualize data
GDP_CO2Emissions$`Country Name` <- as.factor(GDP_CO2Emissions$`Country Name`)
GDP_CO2Emissions$`Country Name` <- factor(GDP_CO2Emissions$`Country Name`, levels = c("Low income", "Low & middle income", "Lower middle income", "Upper middle income", "High income"))
GDP_CO2Emissions %>%
  filter(`Country Name` == "High income" | `Country Name` == "Upper middle income" | `Country Name` == "Lower middle income" | `Country Name` == "Low & middle income" | `Country Name` == "Low income") %>%
  ggplot(aes(x = year)) +
  geom_line(aes(y = GDP_per_cap), color = "green4") +
  geom_line(aes(y = CO2_m_tons_per_cap * 1500), color = "red4") +
  facet_wrap(~`Country Name`, nrow = 1) +
  scale_y_continuous(name = "GDP per Capita",
                     sec.axis = sec_axis(~.x /1500, name = "CO2 Emissions (Metric tons per Capita")) +
  theme(axis.title.y = element_text(color = "green4"),
        axis.title.y.right = element_text(color = "red4"))
  
```
```{r plot_data5.5}
# Plot & visualize data
GDP_CO2Emissions$`Country Name` <- as.factor(GDP_CO2Emissions$`Country Name`)
GDP_CO2Emissions$`Country Name` <- factor(GDP_CO2Emissions$`Country Name`, levels = c("Low income", "Low & middle income", "Lower middle income", "Upper middle income", "High income"))


Totals_GDP_CO2Emissions_Regions %>%
  ggplot(aes(x = year)) +
  geom_line(aes(y = mean_GDP_per_cap), color = "green4") +
  geom_line(aes(y = mean_CO2_m_tons_per_cap * 1500), color = "red4") +
  facet_wrap(~region, nrow = 1) +
  scale_y_continuous(name = "GDP per Capita",
                     sec.axis = sec_axis(~.x /1500, name = "CO2 Emissions (Metric tons per Capita")) +
  theme(axis.title.y = element_text(color = "green4"),
        axis.title.y.right = element_text(color = "red4"))
  
```

```{r plot_data6}
# Plot & visualize data
remove <- c(
"Arab World", "Caribbean small states",
"Central Europe and the Baltics", "East Asia & Pacific",
"East Asia & Pacific (excluding high income)",
"Euro area", "Europe & Central Asia",
"Europe & Central Asia (excluding high income)",
"European Union", "Fragile and conflict affected situations",
"Heavily indebted poor countries (HIPC)", "Latin America & Caribbean",
"Latin America & Caribbean (excluding high income)",
"Least developed countries: UN classification", "Middle East & North Africa",
"Middle East & North Africa (excluding high income)",
"North America", "OECD members", "Other small states",
"Pacific island small states", "Small states", "South Asia",
"Sub-Saharan Africa", "Sub-Saharan Africa (excluding high income)",
"High income", "Low & middle income", "Low income",
"Lower middle income", "Middle income", "Upper middle income",
"Africa Eastern and Southern", "Africa Western and Central",
"Early-demographic dividend", "IBRD only", "IDA & IBRD total", "IDA total",
"IDA blend", "IDA only", "Late-demographic dividend", "Pre-demographic dividend",
"Post-demographic dividend", "East Asia & Pacific (IDA & IBRD countries)",
"Europe & Central Asia (IDA & IBRD countries)", "Latin America & the Caribbean (IDA & IBRD countries)",
"Middle East & North Africa (IDA & IBRD countries)", "South Asia (IDA & IBRD)",
"Sub-Saharan Africa (IDA & IBRD countries)", "World")

GDP_CO2Emissions %>%
  filter(!`Country Name` %in% remove, year == 1990 | year == 2000 | year == 2010 | year == 2019, `Country Name` != "Liechtenstein", `Country Name` != "Luxembourg", , `Country Name` != "Qatar") %>%
  ggplot(aes(x = GDP_per_cap, y = CO2_m_tons_per_cap)) +
  geom_point() +
  geom_text_repel(aes(label = `Country Name`)) +
  facet_wrap(~year, nrow = 1) +
  geom_smooth()
  
```
```{r plot_data5.9}
# Plot & visualize data

GDP_CO2Emissions_Regions %>%
  filter(year == 1990 | year == 2000 | year == 2010 | year == 2019, `Country Name` != "Liechtenstein", `Country Name` != "Luxembourg", `Country Name` != "Qatar", region != is.na(GDP_CO2Emissions_Regions$region)) %>%
  ggplot(aes(x = GDP_per_cap, y = CO2_m_tons_per_cap)) +
  geom_smooth() +
  geom_point(aes(color = region)) +
  facet_wrap(~year, nrow = 1)
  
```

```{r plot_data6}
# Plot & visualize data

GDP_CO2Emissions_Regions %>%
  filter(year == 1990 | year == 2000 | year == 2010 | year == 2019, `Country Name` != "Liechtenstein", `Country Name` != "Luxembourg", `Country Name` != "Qatar", region != is.na(GDP_CO2Emissions_Regions$region)) %>%
  ggplot(aes(x = GDP_per_cap, y = CO2_m_tons_per_cap)) +
  geom_smooth() +
  geom_point(aes(color = region)) +
  facet_grid(vars(region), vars(year), scales = "free_y")
  
```

### Conclusion

## GDP per Capita and CO2 Emissions


### Data Wrangling

Here's the data set we have cleaned and prepared for our analysis:

```{r tidy_data3}
# Clean & wrangle data

```
### Summary Statistics

```{r stats3}
# Get Summary Statistics
BEV %>% st()

```

### Data Visualization and Discussion

```{r plot_data6}
# Plot & visualize data

```


```{r plot_data7}
# Plot & visualize data

```

### Conclusion